# 概要

Udemyの山浦氏の講座「AWS:ゼロから実践するAmazon Web Service。手を動かしながらインフラの基礎を習得」の学習メモ

# 初期設定

## 料金アラートの設定

### 請求書の送信設定
`設定 > 請求設定 > 請求書の送信設定`
- PDF請求書をEメールで配信を有効化

### アラート設定
`設定 > 請求設定 > アラート設定`
- AWS無料利用枠アラートを有効化
- CloudWatch請求アラートを有効化

## CloudWatch

`CloudWatch > アラーム > 請求 > アラームの作成`

- メトリクスの選択 > 請求 > 概算合計請求額
  - メトリクス名：EstimatedCharges
    - 条件：

    | 項目 | 値 |
    | --- | --- |
    | しきい値の種類 | 静的 |
    | EstimatedChargesが次の時... | より大きい |
    | ...よりも | 10USD |

    - 通知：

    | 項目 | 値 |
    | --- | --- |
    | アラーム状態トリガー | アラーム状態 |
    | 次のSNSトピックに通知を送信 | ※作成したトピック選択 |

    - 名前と説明：

    | 項目 | 値 |
    | --- | --- |
    | アラーム名 | 任意の文字列 |
    | アラームの説明 | 任意の文字列 |

  - 登録内容確認後、［アラーム作成］ボタン押下してアラームを作成

## IAM

### 作業用ユーザーを作成する
rootユーザーはなんでもできるのでうっかりやってしまうの避けるため通常作業用ユーザーを作成する
ユーザー毎に操作ログも記録される

#### IAMユーザー/ロールによる請求情報へのアクセス
- rootユーザー以外でも請求情報へアクセスできると便利なのでそれを設定する
  - `アカウント > IAM ユーザーおよびロールによる請求情報へのアクセス `
    - 「IAM アクセスをアクティブ化」にチェックつける

#### ユーザーを作成

`Identity and Access Management (IAM) > ユーザー > ユーザーの作成`

- AWSアクセスの種類を選択

| 項目 | 値 |
| --- | --- |
| ユーザー名 | 任意の文字列 |
| アクセスの種類 | AWS マネジメントコンソールへのユーザーアクセスを提供する - オプション |
| ユーザータイプ | IAM ユーザーを作成します |
| コンソールパスワード | カスタムパスワード |

- 許可を設定

| 項目 | 値 | 備考 |
| --- | --- | --- |
| 許可のオプション | ポリシーを直接アタッチ |  |
| 許可ポリシー | AdministratorAccess | ※講義のため、いろいろできるアカウントにしたいのでこれを設定している |

- タグは追加せず、［ユーザーの作成］ボタンを押下してユーザー作成完了

## CloudTrailで操作ログ記録

- CloudTrailで証跡を作成
  - AWSユーザーの操作を記録するサービス
  - デフォルトは保存期間90日
  - S3にログ保存するよう設定できる
  - CloudTrail自体は無料だがS3の料金は要る

### 証跡の作成

`CloudTrail > 証跡の作成`

- 証跡名入力して作成ボタン押下

# 【VPC】ネットワークを構築

## AWSのネットワークの概念

### VPC
- VPCはAWSに仮想ネットワークを作成できるサービス
- アメリカのリージョンに新しいサービスが最初にリリースされる
- 日本でサービス展開するのであれば東京リージョンがおすすめ
- １つのリージョンにアベイラビリティゾーンが複数ある
  - 災害起きても別のアベイラビリティゾーンがあるので自サービスが維持できる

### サブネット
- サブネットとはVPCを細かく区切ったネットワーク
- VPCの中にサブネット作成して、WebサーバーのサブネットとDBのサブネット作ったりする

## ネットワークのIPアドレスを決める

- 初期に作成するシステムのネットワーク部分
  - VPC：東京リージョンに作成：10.0.0.0/16
    - パブリックサブネット：10.0.10.0/24
    - プライベートサブネット：10.0.20.0/24
  - 東京リージョンは下記３つのアベイラビリティゾーンがある
    - ap-northeast-1a
    - ap-northeast-1c
    - ap-northeast-1d
    - ※最初ap-northeast-1aで構築するが、冗長化するセクションで別のアベイラビリティゾーンもつかう

### IPアドレスについて

- パブリックIPアドレス
  - 重複すると正しく通信できなくなるのでICANNという団体が管理している
  - プロバイダーやサーバー事業者から貸し出される（AWS上でも貸し出される）
- プライベートIPアドレス
  - インターネットで使用されないIPアドレス
  - 下記範囲内のアドレスを自由に使用することができる

    | 範囲 |
    | --- |
    | 10.0.0.0 〜 10.255.255.255 |
    | 172.16.0.0 〜 172.31.255.255 |
    | 192.168.0.0 〜 192.168.255.255 |

  - 社内LANの構築やネットワークの実験時はプライベートIPアドレスを使用する

- IPアドレスの範囲
  - ネットワーク部とホスト部に区分けすることで範囲を表記する
    - 192.168.128.0 〜 192.168.128.255
      - サイダー表記
        - ネットワーク部分が24ビット　→　192.168.128.0/24
        - 24ビットより後ろがホスト部ということになる
        - 192.168.128.0 〜 192.168.128.255の256のIPアドレス、ということになる
      - サブネットマスク表記
        - 192.168.128.0/255.255.255.0
        - サイダー表記と同じく、192.168.128.0 〜 192.168.128.255の256のIPアドレス、ということになる
- 本講座では、VPCが10.0.0.0/16で16ビットより後がホスト部
  - サブネットが10.0.10.0/24, 10.0.20.0/24なので24ビットより後がホスト部

### VPC作成

`VPC > VPCを作成`

| 項目 | 値 | 備考 |
| --- | --- | --- |
| 名前タグ | VPCを識別する名前を登録 |  |
| IPv4 CIDR ブロック | ※本講座では16ビットより後がホスト部のため10.0.0.0/16 |  |
| IPv6 CIDR ブロック | IPv6 CIDR ブロックなし | Amazonが用意しているIPv6とVPCを紐づけることができるが、本講座では必要ないので。 |
| テナンシー | デフォルト | 物理ハードウェアを専用するオプション。EC2の料金が割高になる。特に占有する必要はないのでデフォルトを選択している。 |

